<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parker Brooks: Tactical Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Chart Container Styling Rules */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .agent-card.active {
            ring-width: 4px;
            transform: scale(1.02);
        }
        .tab-btn.active {
            border-bottom-width: 2px;
            font-weight: 700;
        }
    </style>
    <!-- Chosen Palette: Tactical Neutral (Slate/Gray) with Role-Based Accents (Red/Orange for Offense, Blue/Teal for Defense) -->
    <!-- Application Structure Plan:
        1. "Mission Control" (Header & Agent Select): The core interface. Users select one of 6 Agents. This selection drives the state of the entire app.
        2. "Tactical Briefing" (Dynamic Content): Displays the philosophy of the selected Agent based on PB rules.
        3. "Pattern Recognition" (Chart.js): Visualizes the two main PB setups (Pullback vs Breakout) dynamically.
        4. "Risk Calculation Module": A functional tool implementing the 2% rule and R:R ratio, tailored by the Agent's advice.
        5. "System Protocols" (Info Archive): Static reference for EMA/VWAP rules.
        Reasoning: This structure reinforces the "Robot Execution" mindset by putting the Tool (Calculator) and Strategy (Pattern) front and center, guided by the "Agent" persona.
    -->
    <!-- Visualization & Content Choices:
        - Goal: Visualize PB Setups -> Method: Chart.js Line Chart -> Interaction: Toggle between 'Pullback' and 'Breakout' datasets.
        - Goal: Calculate Position Size -> Method: Input Fields + JS Logic -> Interaction: Real-time update based on Account Size & Risk.
        - Goal: Explain Agent Personas -> Method: Dynamic DOM updates -> Interaction: Click on Agent Cards to change context.
        - NO SVG/Mermaid used.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Top Navigation / Branding -->
    <nav class="bg-slate-900 text-white p-4 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold tracking-wider">PB-TCC <span class="text-slate-400 text-sm font-normal">| Parker Brooks Tactical Command Center</span></h1>
            <div class="text-xs md:text-sm bg-slate-800 px-3 py-1 rounded">System Status: <span class="text-green-400 font-bold">ONLINE</span></div>
        </div>
    </nav>

    <div class="container mx-auto p-4 md:p-6 space-y-8">

        <!-- SECTION 1: THE SIX SAGES (Agent Selector) -->
        <!-- Context: This is the heart of the requested software. It allows the user to choose their "Mode".
             The app changes its feedback style based on this selection. -->
        <section id="agent-selector-section">
            <div class="mb-4">
                <h2 class="text-2xl font-bold text-slate-800">1. Operation Mode: The Six Sages</h2>
                <p class="text-slate-600 mt-2">
                    íˆ¬ììì˜ í˜„ì¬ ì‹¬ë¦¬ ìƒíƒœì™€ ì‹œì¥ ìƒí™©ì— ë§ì¶° 6ëª…ì˜ í˜„ì(Agent) ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì‹­ì‹œì˜¤. 
                    ì„ íƒëœ AgentëŠ” íŒŒì»¤ ë¸Œë£©ìŠ¤ì˜ ê¸°ë²•ì„ ê¸°ë°˜ìœ¼ë¡œ ìµœì í™”ëœ ì¡°ì–¸ê³¼ ë¦¬ìŠ¤í¬ ê´€ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
                </p>
            </div>

            <!-- Agents Grid -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6">
                <!-- Attack Group -->
                <button onclick="selectAgent('adpetere')" id="btn-adpetere" class="agent-card bg-white p-3 rounded-lg border border-slate-200 shadow-sm hover:shadow-md transition-all text-left">
                    <div class="text-xs font-bold text-orange-600 uppercase mb-1">Offense (Passive)</div>
                    <div class="font-bold text-lg">Adpetere</div>
                    <div class="text-xs text-slate-500">ì „ì§„ ëª¨ë“œ</div>
                </button>
                <button onclick="selectAgent('proelium')" id="btn-proelium" class="agent-card bg-white p-3 rounded-lg border border-slate-200 shadow-sm hover:shadow-md transition-all text-left">
                    <div class="text-xs font-bold text-red-600 uppercase mb-1">Offense (Active)</div>
                    <div class="font-bold text-lg">Proelium</div>
                    <div class="text-xs text-slate-500">ì „íˆ¬ ëª¨ë“œ</div>
                </button>
                <button onclick="selectAgent('cursus')" id="btn-cursus" class="agent-card bg-white p-3 rounded-lg border border-slate-200 shadow-sm hover:shadow-md transition-all text-left">
                    <div class="text-xs font-bold text-red-800 uppercase mb-1">Offense (Aggro)</div>
                    <div class="font-bold text-lg">Cursus</div>
                    <div class="text-xs text-slate-500">ëŒê²© ëª¨ë“œ</div>
                </button>

                <!-- Defense Group -->
                <button onclick="selectAgent('custodia')" id="btn-custodia" class="agent-card bg-white p-3 rounded-lg border border-slate-200 shadow-sm hover:shadow-md transition-all text-left">
                    <div class="text-xs font-bold text-teal-600 uppercase mb-1">Defense (Passive)</div>
                    <div class="font-bold text-lg">Custodia</div>
                    <div class="text-xs text-slate-500">ê²½ê³„ ëª¨ë“œ</div>
                </button>
                <button onclick="selectAgent('scutum')" id="btn-scutum" class="agent-card bg-white p-3 rounded-lg border border-slate-200 shadow-sm hover:shadow-md transition-all text-left">
                    <div class="text-xs font-bold text-blue-600 uppercase mb-1">Defense (Active)</div>
                    <div class="font-bold text-lg">Scutum</div>
                    <div class="text-xs text-slate-500">ìˆ˜ë¹„ ëª¨ë“œ</div>
                </button>
                <button onclick="selectAgent('tectum')" id="btn-tectum" class="agent-card bg-white p-3 rounded-lg border border-slate-200 shadow-sm hover:shadow-md transition-all text-left">
                    <div class="text-xs font-bold text-indigo-800 uppercase mb-1">Defense (Aggro)</div>
                    <div class="font-bold text-lg">Tectum</div>
                    <div class="text-xs text-slate-500">ë°©ì–´ ëª¨ë“œ</div>
                </button>
            </div>

            <!-- Active Agent Dashboard -->
            <div id="agent-dashboard" class="bg-white border-l-4 border-slate-500 p-6 rounded-r-lg shadow-sm">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                    <div>
                        <h3 id="agent-name" class="text-2xl font-bold text-slate-800">SYSTEM IDLE</h3>
                        <p id="agent-role" class="text-sm font-medium text-slate-500">ìš´ì˜ ëª¨ë“œë¥¼ ì„ íƒí•˜ì‹­ì‹œì˜¤.</p>
                    </div>
                    <div id="agent-badge" class="mt-2 md:mt-0 px-4 py-1 rounded-full bg-slate-100 text-slate-600 text-sm font-bold">
                        WAITING
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-bold text-slate-700 mb-2">ğŸ“œ Tactical Directive (ì§€ì¹¨)</h4>
                        <p id="agent-desc" class="text-slate-600 text-sm leading-relaxed">
                            PB ì‹œìŠ¤í…œì´ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤. ìƒë‹¨ì˜ 6ê°œ ëª¨ë“œ ì¤‘ í•˜ë‚˜ë¥¼ í´ë¦­í•˜ì—¬ ì‹œìŠ¤í…œì„ ê°€ë™í•˜ì‹­ì‹œì˜¤.
                        </p>
                    </div>
                    <div>
                        <h4 class="font-bold text-slate-700 mb-2">âš™ï¸ Protocol Settings (ì„¤ì •ê°’)</h4>
                        <ul class="text-sm text-slate-600 space-y-1">
                            <li><span class="font-semibold w-24 inline-block">Risk Rule:</span> <span id="agent-risk">N/A</span></li>
                            <li><span class="font-semibold w-24 inline-block">Entry Focus:</span> <span id="agent-entry">N/A</span></li>
                            <li><span class="font-semibold w-24 inline-block">Mental Key:</span> <span id="agent-mental">N/A</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: TACTICAL CALCULATOR (Risk Management) -->
        <!-- Context: Implements Parker Brooks' "Money Management" rules (2% Rule, R:R).
             The user inputs their trade idea, and the logic validates it against the selected Agent's strictness. -->
        <section class="bg-white rounded-xl shadow p-6">
            <div class="mb-6 border-b border-slate-100 pb-4">
                <h2 class="text-xl font-bold text-slate-800 flex items-center">
                    <span class="mr-2 text-2xl">ğŸ§®</span> Position Size Calculator
                </h2>
                <p class="text-sm text-slate-500 mt-1">
                    PB ê¸°ë²•ì˜ í•µì‹¬ì¸ ìê¸ˆ ê´€ë¦¬(2% Rule)ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. í˜„ì¬ í™œì„±í™”ëœ Agentê°€ ì§„ì… ì ì •ì„±ì„ ê²€í† í•©ë‹ˆë‹¤.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Inputs -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Total Capital ($)</label>
                        <input type="number" id="input-capital" value="10000" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 outline-none font-mono">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Entry Price ($)</label>
                        <input type="number" id="input-entry" placeholder="e.g. 150.50" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 outline-none font-mono">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Stop Loss ($)</label>
                        <input type="number" id="input-stop" placeholder="e.g. 148.00" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 outline-none font-mono">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Target Price ($)</label>
                        <input type="number" id="input-target" placeholder="e.g. 155.50" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 outline-none font-mono">
                    </div>
                    <button onclick="calculatePosition()" class="w-full bg-slate-800 text-white font-bold py-3 rounded hover:bg-slate-700 transition-colors">
                        CALCULATE ORDER
                    </button>
                </div>

                <!-- Results Display -->
                <div class="lg:col-span-2 bg-slate-50 rounded-lg p-6 border border-slate-200">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-6">
                        <div class="p-2">
                            <div class="text-xs text-slate-500 uppercase">Risk (2% Max)</div>
                            <div id="res-risk-amt" class="text-xl font-bold text-red-600">--</div>
                        </div>
                        <div class="p-2">
                            <div class="text-xs text-slate-500 uppercase">Shares/Qty</div>
                            <div id="res-qty" class="text-xl font-bold text-slate-800">--</div>
                        </div>
                        <div class="p-2">
                            <div class="text-xs text-slate-500 uppercase">Total Value</div>
                            <div id="res-total" class="text-xl font-bold text-slate-600">--</div>
                        </div>
                        <div class="p-2">
                            <div class="text-xs text-slate-500 uppercase">R:R Ratio</div>
                            <div id="res-rr" class="text-xl font-bold text-blue-600">--</div>
                        </div>
                    </div>

                    <!-- Agent Feedback Area -->
                    <div id="calc-feedback" class="bg-white p-4 rounded border-l-4 border-gray-300 text-sm">
                        <p class="text-gray-500 italic">"ë°ì´í„°ë¥¼ ì…ë ¥í•˜ê³  ê³„ì‚° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, í˜„ì¬ Agentê°€ ë¶„ì„ ê²°ê³¼ë¥¼ ì œê³µí•©ë‹ˆë‹¤."</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: STRATEGY VISUALIZER (Charts) -->
        <!-- Context: Visualizes the "Pullback" and "Breakout" concepts described in the PB markdown.
             Since we don't have real-time data, we generate ideal mathematical models of these setups. -->
        <section class="bg-white rounded-xl shadow p-6">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-slate-100 pb-4">
                <div>
                    <h2 class="text-xl font-bold text-slate-800">ğŸ“‰ Setup Pattern Recognizer</h2>
                    <p class="text-sm text-slate-500 mt-1">PB ê¸°ë²•ì˜ ë‘ ê°€ì§€ ë©”ì¸ ì…‹ì—…(Pullback, Breakout)ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•˜ì‹­ì‹œì˜¤.</p>
                </div>
                <div class="flex space-x-2 mt-4 md:mt-0">
                    <button onclick="renderChart('pullback')" class="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded text-sm font-bold transition">Pullback Mode</button>
                    <button onclick="renderChart('breakout')" class="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded text-sm font-bold transition">Breakout Mode</button>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="w-full flex justify-center">
                <div class="chart-container">
                    <canvas id="strategyChart"></canvas>
                </div>
            </div>

            <!-- Strategy Explanation -->
            <div id="chart-explanation" class="mt-6 p-4 bg-slate-50 rounded border border-slate-200 text-sm text-slate-700">
                <!-- Dynamic text populated by JS -->
            </div>
        </section>

        <!-- SECTION 4: PB PROTOCOL DATABASE (Info) -->
        <!-- Context: A quick reference guide for the user, extracting the "Hardware" (Technical Indicators) 
             and "Software" (Psychology) rules from the MD file. -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Hardware Specs -->
            <div class="bg-white rounded-xl shadow p-6">
                <h3 class="text-lg font-bold text-slate-800 mb-4 border-b pb-2">ğŸ› ï¸ Hardware: Technical Indicators</h3>
                <ul class="space-y-3 text-sm text-slate-600">
                    <li class="flex items-start">
                        <span class="mr-2 text-lg">ğŸ•¯ï¸</span>
                        <div>
                            <span class="font-bold text-slate-800">Chart Timeframe:</span> 5ë¶„ë´‰ (5-min Chart)ì´ ë©”ì¸.
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="mr-2 text-lg">ğŸ“ˆ</span>
                        <div>
                            <span class="font-bold text-slate-800">EMAs (ì§€ìˆ˜ì´ë™í‰ê· ):</span>
                            <ul class="list-disc pl-4 mt-1 space-y-1">
                                <li><span class="text-blue-600 font-bold">9 EMA:</span> ë‹¨ê¸° ì¶”ì„¸/ëª¨ë©˜í…€ ê°€ì´ë“œ (Runner í™€ë”© ê¸°ì¤€).</li>
                                <li><span class="text-green-600 font-bold">20 EMA:</span> Pullback(ëˆŒë¦¼ëª©) ì§„ì…ì˜ í•µì‹¬ ì§€ì§€ì„ .</li>
                                <li><span class="text-orange-600 font-bold">50 EMA:</span> ì¤‘ê¸° ì¶”ì„¸ í•„í„°. ì´ ìœ„ì—ì„œ ë¡± í¬ì§€ì…˜ ìœ ë¦¬.</li>
                                <li><span class="text-slate-600 font-bold">200 EMA:</span> ì¥ê¸° ì¶”ì„¸ì„ . ê°•í•œ ì§€ì§€/ì €í•­ ë ˆë²¨.</li>
                            </ul>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="mr-2 text-lg">ğŸ“Š</span>
                        <div>
                            <span class="font-bold text-slate-800">VWAP (ê±°ë˜ëŸ‰ê°€ì¤‘í‰ê· ):</span> ê¸°ê´€ ìˆ˜ê¸‰ì˜ ê¸°ì¤€. ë°ì´íŠ¸ë ˆì´ë”©ì˜ ë‚˜ì¹¨ë°˜ ì—­í• .
                        </div>
                    </li>
                </ul>
            </div>

            <!-- Software Specs -->
            <div class="bg-white rounded-xl shadow p-6">
                <h3 class="text-lg font-bold text-slate-800 mb-4 border-b pb-2">ğŸ§  Software: Mindset & Rules</h3>
                <ul class="space-y-3 text-sm text-slate-600">
                    <li class="flex items-start">
                        <span class="mr-2 text-lg">ğŸ¤–</span>
                        <div>
                            <span class="font-bold text-slate-800">Robot Mode:</span> ì˜ˆì¸¡í•˜ì§€ ì•Šê³ , ì¡°ê±´(If-Then)ì— ë”°ë¼ ì‹¤í–‰ë§Œ í•œë‹¤. ê°ì • ë°°ì œ.
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="mr-2 text-lg">ğŸ›‘</span>
                        <div>
                            <span class="font-bold text-slate-800">Stop Loss Protocol:</span>
                            <br>ì§„ì…ê³¼ ë™ì‹œì— ì„¤ì •. ì „ ì €ì , ì£¼ìš” EMA ì´íƒˆ ì‹œ ì¦‰ì‹œ ì†ì ˆ. ê¸°ë„ëŠ” ì „ëµì´ ì•„ë‹ˆë‹¤.
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="mr-2 text-lg">ğŸ’°</span>
                        <div>
                            <span class="font-bold text-slate-800">Profit Taking:</span>
                            <br>1ì°¨ ëª©í‘œê°€(1:2)ì—ì„œ ì ˆë°˜ ì²­ì‚°. ë‚˜ë¨¸ì§€ëŠ” 9 EMAë¥¼ ì´íƒˆí•  ë•Œê¹Œì§€ í™€ë”©(Runner Strategy).
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="mr-2 text-lg">âš ï¸</span>
                        <div>
                            <span class="font-bold text-slate-800">Daily Max Loss:</span>
                            <br>ì¼ì¼ í—ˆìš© ì†ì‹¤ ì´ˆê³¼ ì‹œ ì¦‰ì‹œ HTS ì¢…ë£Œ. Revenge Trading ê¸ˆì§€.
                        </div>
                    </li>
                </ul>
            </div>
        </section>

        <footer class="text-center text-slate-400 text-xs py-8">
            <p>Parker Brooks Trading System Simulator | Based on User Provided Protocol</p>
        </footer>

    </div>

    <!-- MAIN JAVASCRIPT LOGIC -->
    <script>
        // --- 1. DATA & STATE MANAGEMENT ---
        
        // Agent Definitions: Defines the personality, colors, and specific advice logic for each mode
        const agents = {
            'adpetere': {
                name: 'Adpetere',
                role: 'ì „ì§„ ëª¨ë“œ (ì†Œê·¹ì  ê³µê²©)',
                badgeColor: 'bg-orange-100 text-orange-700',
                borderColor: 'border-orange-500',
                desc: 'ì•ˆì •ì ì¸ ì¶”ì„¸ê°€ í™•ì¸ëœ í›„, í™•ì‹¤í•œ ëˆŒë¦¼ëª©(Pullback)ì—ì„œë§Œ ì§„ì…í•©ë‹ˆë‹¤. ë¬´ë¦¬í•œ ëŒíŒŒ ë§¤ë§¤ë¥¼ ì§€ì–‘í•˜ê³ , ìŠ¹ë¥ ì´ ë†’ì€ ìë¦¬ë§Œ ê³¨ë¼ íƒ€ê²©í•©ë‹ˆë‹¤.',
                risk: 'Standard (1.5 ~ 2%)',
                entry: 'Strict Pullback (20EMA)',
                mental: 'Patience (ì¸ë‚´)',
                adviceLogic: (rr) => {
                    if(rr < 2.5) return "Adpetere ê²½ê³ : ì†Œê·¹ì  ê³µê²© ëª¨ë“œì—ì„œëŠ” ë” ë†’ì€ ì†ìµë¹„(ìµœì†Œ 1:2.5)ê°€ í•„ìš”í•©ë‹ˆë‹¤. í˜„ì¬ ìë¦¬ëŠ” ë§¤ë ¥ì ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.";
                    return "Adpetere ìŠ¹ì¸: ì•ˆì •ì ì¸ ì§„ì… êµ¬ê°„ì…ë‹ˆë‹¤. ê³„íšëŒ€ë¡œ ì‹¤í–‰í•˜ì‹­ì‹œì˜¤.";
                }
            },
            'proelium': {
                name: 'Proelium',
                role: 'ì „íˆ¬ ëª¨ë“œ (ëŠ¥ë™ì  ê³µê²©)',
                badgeColor: 'bg-red-100 text-red-700',
                borderColor: 'border-red-500',
                desc: 'í‘œì¤€ì ì¸ PB ê¸°ë²•ì„ êµ¬ì‚¬í•©ë‹ˆë‹¤. ëˆŒë¦¼ëª©ê³¼ ê±°ë˜ëŸ‰ì´ ë™ë°˜ëœ ëŒíŒŒ ë§¤ë§¤ë¥¼ ëª¨ë‘ ìˆ˜í–‰í•˜ë©°, ì ê·¹ì ìœ¼ë¡œ ìˆ˜ìµ ê¸°íšŒë¥¼ í¬ì°©í•©ë‹ˆë‹¤.',
                risk: 'Max (2%)',
                entry: 'Pullback & Breakout',
                mental: 'Execution (ì‹¤í–‰ë ¥)',
                adviceLogic: (rr) => {
                    if(rr < 2.0) return "Proelium ì•Œë¦¼: ì†ìµë¹„ê°€ 1:2 ë¯¸ë§Œì…ë‹ˆë‹¤. ì§„ì…ì„ ì¬ê³ í•˜ê±°ë‚˜ ëª©í‘œê°€ë¥¼ ìƒí–¥ ì¡°ì •í•˜ì‹­ì‹œì˜¤.";
                    return "Proelium ìŠ¹ì¸: êµì „ í—ˆê°€. ë¡œë´‡ì²˜ëŸ¼ ì§„ì…í•˜ê³  ì²­ì‚°í•˜ì‹­ì‹œì˜¤.";
                }
            },
            'cursus': {
                name: 'Cursus',
                role: 'ëŒê²© ëª¨ë“œ (ì ê·¹ì  ê³µê²©)',
                badgeColor: 'bg-red-200 text-red-900',
                borderColor: 'border-red-800',
                desc: 'ê°•í•œ ëª¨ë©˜í…€ì„ ì¶”ì¢…í•©ë‹ˆë‹¤. ë³€ë™ì„±ì´ í° ì¥ì„¸ì—ì„œ 9 EMAë¥¼ íƒ€ê³  ì˜¤ë¥´ëŠ” ê¸‰ë“±ì£¼ë¥¼ íƒ€ê²©í•©ë‹ˆë‹¤. ë¦¬ìŠ¤í¬ë¥¼ ê°ìˆ˜í•˜ê³  í° ì¶”ì„¸ë¥¼ ë…¸ë¦½ë‹ˆë‹¤.',
                risk: 'Aggressive (2% + Alpha)',
                entry: 'High Momentum Breakout',
                mental: 'Courage (ìš©ê¸°)',
                adviceLogic: (rr) => {
                    if(rr < 1.5) return "Cursus ê²½ê³ : ì•„ë¬´ë¦¬ ê³µê²©ì ì´ë¼ë„ ì†ìµë¹„ 1:1.5 ì´í•˜ëŠ” ë„ë°•ì…ë‹ˆë‹¤.";
                    return "Cursus ìŠ¹ì¸: ëª¨ë©˜í…€ì´ í™•ì¸ë˜ì—ˆë‹¤ë©´ ì¦‰ì‹œ ì§„ì…í•˜ì‹­ì‹œì˜¤. 9 EMA ì´íƒˆ ì „ê¹Œì§€ ë§¤ë„ ê¸ˆì§€.";
                }
            },
            'custodia': {
                name: 'Custodia',
                role: 'ê²½ê³„ ëª¨ë“œ (ì†Œê·¹ì  ë°©ì–´)',
                badgeColor: 'bg-teal-100 text-teal-700',
                borderColor: 'border-teal-500',
                desc: 'ìë³¸ ë³´ì¡´ì„ ìµœìš°ì„ ìœ¼ë¡œ í•©ë‹ˆë‹¤. ì‹œì¥ ìƒí™©ì´ ëª¨í˜¸í•  ë•Œ ì‚¬ìš©í•˜ë©°, ì™„ë²½í•œ A+ ì…‹ì—…ì´ ì•„ë‹ˆë©´ ê´€ë§í•©ë‹ˆë‹¤.',
                risk: 'Conservative (1%)',
                entry: 'Perfect Pullback Only',
                mental: 'Preservation (ë³´ì¡´)',
                adviceLogic: (rr) => {
                    if(rr < 3.0) return "Custodia ì°¨ë‹¨: ê²½ê³„ ëª¨ë“œì…ë‹ˆë‹¤. ì†ìµë¹„ 1:3 ì´ìƒì˜ ì™„ë²½í•œ ìë¦¬ê°€ ì•„ë‹ˆë©´ í˜„ê¸ˆì„ ë³´ìœ í•˜ì‹­ì‹œì˜¤.";
                    return "Custodia ìŠ¹ì¸: ë¦¬ìŠ¤í¬ê°€ ê·¹íˆ ë‚®ìŠµë‹ˆë‹¤. ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ì§„ì…í•˜ì‹­ì‹œì˜¤.";
                }
            },
            'scutum': {
                name: 'Scutum',
                role: 'ìˆ˜ë¹„ ëª¨ë“œ (ëŠ¥ë™ì  ë°©ì–´)',
                badgeColor: 'bg-blue-100 text-blue-700',
                borderColor: 'border-blue-500',
                desc: 'ì†ì‹¤ì„ ì¤„ì´ëŠ” ë° ì§‘ì¤‘í•©ë‹ˆë‹¤. ì§„ì… í›„ ì¡°ê¸ˆì´ë¼ë„ ìˆ˜ìµì´ ë‚˜ë©´ ë³¸ì ˆ(Breakeven)ë¡œ ìŠ¤íƒ‘ì„ ë¹ ë¥´ê²Œ ì´ë™í•˜ì—¬ ë¦¬ìŠ¤í¬ë¥¼ ì œê±°í•©ë‹ˆë‹¤.',
                risk: 'Reduced (1 ~ 1.5%)',
                entry: 'Defensive Entries',
                mental: 'Defense (ë°©ì–´)',
                adviceLogic: (rr) => {
                    if(rr < 2.0) return "Scutum ì•Œë¦¼: ë°©ì–´ ëª¨ë“œì—ì„œëŠ” í™•ì‹¤í•œ ìŠ¹ë¦¬ ê¸°íšŒë§Œ ì—¿ë´…ë‹ˆë‹¤. ì¡°ê¸ˆ ë” ê¸°ë‹¤ë¦¬ì‹­ì‹œì˜¤.";
                    return "Scutum ìŠ¹ì¸: ì§„ì… í›„ ì¦‰ì‹œ ìŠ¤íƒ‘ë¡œìŠ¤ë¥¼ ë³¸ì ˆë¡œ ì˜¬ë¦´ ì¤€ë¹„ë¥¼ í•˜ì‹­ì‹œì˜¤.";
                }
            },
            'tectum': {
                name: 'Tectum',
                role: 'ë°©ì–´ ëª¨ë“œ (ì ê·¹ì  ë°©ì–´)',
                badgeColor: 'bg-indigo-100 text-indigo-800',
                borderColor: 'border-indigo-800',
                desc: 'ì—°íŒ¨ ì¤‘ì´ê±°ë‚˜ ë©˜íƒˆì´ í”ë“¤ë¦´ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ë§¤ë§¤ íšŸìˆ˜ë¥¼ ê·¹ë„ë¡œ ì œí•œí•˜ê³ , ë‡Œë™ ë§¤ë§¤ë¥¼ ì›ì²œ ì°¨ë‹¨í•˜ëŠ” ê°€ì¥ ì—„ê²©í•œ ëª¨ë“œì…ë‹ˆë‹¤.',
                risk: 'Minimal (0.5% or No Trade)',
                entry: 'Simulator / Observation',
                mental: 'Discipline (ê·œìœ¨)',
                adviceLogic: (rr) => {
                    return "Tectum ê²½ê³ : í˜„ì¬ëŠ” ì ê·¹ì  ë°©ì–´ íƒœì„¸ì…ë‹ˆë‹¤. ë§¤ë§¤ë³´ë‹¤ëŠ” ì°¨íŠ¸ ê´€ë§ê³¼ ì‹¬ë¦¬ íšŒë³µì— ì§‘ì¤‘í•˜ì‹­ì‹œì˜¤. (ê¶Œì¥: No Trade)";
                }
            }
        };

        let currentAgentId = null;
        let myChart = null;

        // --- 2. CORE FUNCTIONS ---

        function selectAgent(agentId) {
            currentAgentId = agentId;
            const agent = agents[agentId];

            // 1. Update UI Selection State
            document.querySelectorAll('.agent-card').forEach(card => {
                card.classList.remove('active', 'ring-4', 'ring-opacity-50', 'ring-slate-300', 'border-orange-500', 'border-red-500', 'border-red-800', 'border-teal-500', 'border-blue-500', 'border-indigo-800');
            });
            
            const btn = document.getElementById(`btn-${agentId}`);
            btn.classList.add('active', 'ring-4', 'ring-opacity-50');
            // Add specific border color based on agent config
            const colorClass = agent.borderColor.split(' ')[0]; // Extract border class
            btn.classList.add(colorClass);

            // 2. Update Dashboard Content
            document.getElementById('agent-dashboard').className = `bg-white border-l-4 ${agent.borderColor} p-6 rounded-r-lg shadow-sm transition-all`;
            document.getElementById('agent-name').innerText = agent.name;
            document.getElementById('agent-role').innerText = agent.role;
            document.getElementById('agent-badge').className = `mt-2 md:mt-0 px-4 py-1 rounded-full text-sm font-bold ${agent.badgeColor}`;
            document.getElementById('agent-badge').innerText = "ACTIVE";
            document.getElementById('agent-desc').innerText = agent.desc;
            document.getElementById('agent-risk').innerText = agent.risk;
            document.getElementById('agent-entry').innerText = agent.entry;
            document.getElementById('agent-mental').innerText = agent.mental;

            // 3. Trigger Recalculation if inputs exist
            if(document.getElementById('input-entry').value) {
                calculatePosition();
            } else {
                // Reset feedback
                document.getElementById('calc-feedback').innerHTML = `<p class="text-slate-500">Agent <span class="font-bold">${agent.name}</span>ê°€ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤. ë§¤ë§¤ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>`;
                document.getElementById('calc-feedback').className = `bg-white p-4 rounded border-l-4 ${agent.borderColor} text-sm`;
            }
        }

        function calculatePosition() {
            if (!currentAgentId) {
                alert("ë¨¼ì € Agent(ìš´ì˜ ëª¨ë“œ)ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");
                return;
            }

            const capital = parseFloat(document.getElementById('input-capital').value);
            const entry = parseFloat(document.getElementById('input-entry').value);
            const stop = parseFloat(document.getElementById('input-stop').value);
            const target = parseFloat(document.getElementById('input-target').value);

            if (!capital || !entry || !stop || !target) return;

            // Basic Calculations
            const riskPerShare = Math.abs(entry - stop);
            const rewardPerShare = Math.abs(target - entry);
            const rrRatio = (rewardPerShare / riskPerShare).toFixed(2);
            
            // 2% Rule (Standard) - modified by Agent in a real app, but here we show standard calculation and agent warns
            const maxRiskAmount = capital * 0.02; 
            const shares = Math.floor(maxRiskAmount / riskPerShare);
            const totalValue = shares * entry;

            // Display Results
            document.getElementById('res-risk-amt').innerText = `$${maxRiskAmount.toFixed(2)}`;
            document.getElementById('res-qty').innerText = `${shares.toLocaleString()} shares`;
            document.getElementById('res-total').innerText = `$${totalValue.toLocaleString()}`;
            document.getElementById('res-rr').innerText = `1 : ${rrRatio}`;

            // Agent Feedback
            const agent = agents[currentAgentId];
            const feedbackText = agent.adviceLogic(rrRatio);
            
            const feedbackBox = document.getElementById('calc-feedback');
            feedbackBox.className = `bg-white p-4 rounded border-l-4 ${agent.borderColor} text-sm transition-all`;
            
            // Highlight feedback based on sentiment (simple check)
            let sentimentColor = "text-slate-700";
            if(feedbackText.includes("ê²½ê³ ") || feedbackText.includes("ì°¨ë‹¨")) sentimentColor = "text-red-600 font-bold";
            else if(feedbackText.includes("ìŠ¹ì¸")) sentimentColor = "text-green-600 font-bold";

            feedbackBox.innerHTML = `
                <div class="font-bold mb-1 flex items-center">
                    <span class="mr-2">ğŸ—£ï¸</span> ${agent.name}'s Analysis:
                </div>
                <p class="${sentimentColor}">${feedbackText}</p>
                <div class="mt-2 text-xs text-slate-400 border-t pt-2">
                    * PB ì›ì¹™: ì†ì ˆí­ì€ 2%ë¥¼ ë„˜ì§€ ë§ê³ , ì†ìµë¹„ëŠ” 1:2 ì´ìƒì„ ì§€í–¥í•˜ì‹­ì‹œì˜¤.
                </div>
            `;
        }

        // --- 3. CHART VISUALIZATION LOGIC ---

        function renderChart(mode) {
            const ctx = document.getElementById('strategyChart').getContext('2d');
            const explanationDiv = document.getElementById('chart-explanation');

            if (myChart) {
                myChart.destroy();
            }

            let labels, dataPrice, dataEMA, dataVWAP, title, desc;

            if (mode === 'pullback') {
                // Generate "Pullback" Data (Uptrend -> Dip to EMA -> Rise)
                title = "Setup A: The Pullback (ëˆŒë¦¼ëª©)";
                desc = "<strong>[PB Pullback ì „ëµ]</strong><br>1. ì£¼ê°€ê°€ 20 EMA ìœ„ì—ì„œ ìƒìŠ¹ ì¶”ì„¸.<br>2. 20 EMA ë˜ëŠ” VWAP ë¶€ê·¼ê¹Œì§€ í•˜ë½(Pullback).<br>3. ì§€ì§€ ìº”ë“¤ í™•ì¸ í›„ ì§„ì….<br>4. Agent 'Adpetere', 'Custodia'ê°€ ì„ í˜¸í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.";
                labels = Array.from({length: 20}, (_, i) => i + 1);
                // Simulated Price: Up, then down to EMA, then bounce up
                dataPrice = [100, 102, 105, 108, 110, 109, 107, 106, 105.5, 106, 108, 110, 113, 115, 118, 120, 122, 125, 128, 130];
                // EMA: Steady uptrend acting as support
                dataEMA =   [98,  99,  100, 102, 103, 104, 104.5, 105, 105.5, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116];
                
            } else {
                // Generate "Breakout" Data (Consolidation -> Surge)
                title = "Setup B: The Breakout (ëŒíŒŒ)";
                desc = "<strong>[PB Breakout ì „ëµ]</strong><br>1. íŠ¹ì •í•œ ê°€ê²©ëŒ€(ì €í•­ì„ ) ì•„ë˜ì—ì„œ íš¡ë³´/ìˆ˜ë ´.<br>2. 9 EMAê°€ ê°€ê²©ì„ ë°€ì–´ì˜¬ë¦¬ë©° ì••ì¶•.<br>3. ê°•í•œ ê±°ë˜ëŸ‰ê³¼ í•¨ê»˜ ì €í•­ì„  ëŒíŒŒ.<br>4. Agent 'Proelium', 'Cursus'ê°€ ì„ í˜¸í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.";
                labels = Array.from({length: 20}, (_, i) => i + 1);
                // Simulated Price: Flat, then explode
                dataPrice = [100, 101, 100, 102, 101, 102, 101, 102, 102.5, 103, 105, 108, 112, 115, 118, 120, 122, 125, 127, 130];
                // Resistance Line (Visual guide)
                dataEMA =   [102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102];
            }

            explanationDiv.innerHTML = desc;

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Price Action',
                            data: dataPrice,
                            borderColor: '#334155', // Slate 700
                            backgroundColor: 'rgba(51, 65, 85, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: false
                        },
                        {
                            label: mode === 'pullback' ? '20 EMA (Support)' : 'Resistance Level',
                            data: dataEMA,
                            borderColor: mode === 'pullback' ? '#16a34a' : '#dc2626', // Green or Red
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: title,
                            font: { size: 16 }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    scales: {
                        y: {
                            display: true,
                            title: { display: true, text: 'Price ($)' }
                        },
                        x: {
                            display: false
                        }
                    }
                }
            });
        }

        // Initialize App
        window.onload = function() {
            // Default selection
            selectAgent('proelium'); 
            renderChart('pullback');
        };

    </script>
</body>
</html>